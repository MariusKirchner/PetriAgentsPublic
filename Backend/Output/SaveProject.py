from xml.dom import minidom, Node
def saveProject(mainProject, filehandler):
    doc = minidom.Document()
    doc.appendChild(doc.createComment("PetriAgent Project during Development!"))
    project = doc.createElement("Project")
    doc.appendChild(project)

    settings = doc.createElement("Settings")
    project.appendChild(settings)
    maxXCor = doc.createElement("maxXCor")
    settings.appendChild(maxXCor)
    maxXCor.appendChild(doc.createTextNode(str(mainProject.maxXCor)))
    maxYCor = doc.createElement("maxYCor")
    settings.appendChild(maxYCor)
    maxYCor.appendChild(doc.createTextNode(str(mainProject.maxYCor)))
    ticks = doc.createElement("Ticks")
    settings.appendChild(ticks)
    ticks.appendChild(doc.createTextNode(str(mainProject.ticks)))
    #TODO: following will be secluded for each compartment later on, then netlogosettings will be more specific
    lrCont = doc.createElement("lrCont")
    settings.appendChild(lrCont)
    lrCont.appendChild(doc.createTextNode(str(mainProject.lrCont)))
    tbCont = doc.createElement("tbCont")
    settings.appendChild(tbCont)
    tbCont.appendChild(doc.createTextNode(str(mainProject.tbCont)))
    diffRate = doc.createElement("diffRate")
    settings.appendChild(diffRate)
    diffRate.appendChild(doc.createTextNode(str(mainProject.diffRate)))
    diffBool = doc.createElement("diffBool")
    settings.appendChild(diffBool)
    diffBool.appendChild(doc.createTextNode(str(mainProject.diffBool)))
    flowRate = doc.createElement("flowRate")
    settings.appendChild(flowRate)
    flowRate.appendChild(doc.createTextNode(str(mainProject.flowRate)))
    flowDir = doc.createElement("flowDir")
    settings.appendChild(flowDir)
    flowDir.appendChild(doc.createTextNode(str(mainProject.flowDir)))
    flowBool = doc.createElement("flowBool")
    settings.appendChild(flowBool)
    flowBool.appendChild(doc.createTextNode(str(mainProject.flowBool)))

    bacteria = doc.createElement("bacteria")
    project.appendChild(bacteria)
    for id in mainProject.listOfBacteriaIDs:
        tempBac = doc.createElement(mainProject.bacteriaIDDict[id].name)
        tempPetri = mainProject.bacteriaIDDict[id].petriNet
        places = doc.createElement("places")
        tempBac.appendChild(places)
        for placeID in tempPetri.placeIDList:
            tempPlace = doc.createElement(tempPetri.placeDict[placeID].name)
            tempPlaceID = doc.createElement("PlaceID")
            tempPlace.appendChild(tempPlaceID)
            tempPlaceID.appendChild(doc.createTextNode(str(placeID)))
            tempPlaceName = doc.createElement("PlaceName")
            tempPlace.appendChild(tempPlaceName)
            tempPlaceName.appendChild(doc.createTextNode(tempPetri.placeDict[placeID].name))
            tempPlaceWeight = doc.createElement("PlaceWeight")
            tempPlace.appendChild(tempPlaceWeight)
            tempPlaceWeight.appendChild(doc.createTextNode(str(tempPetri.placeDict[placeID].tokens)))
            places.appendChild(tempPlace)
        transitions = doc.createElement("transitions")
        tempBac.appendChild(transitions)
        for transID in tempPetri.transitionIDList:
            tempTransition = doc.createElement(tempPetri.transitionDict[transID].name)
            tempTransitionID = doc.createElement("TransID")
            tempTransition.appendChild(tempTransitionID)
            tempTransitionID.appendChild(doc.createTextNode(str(transID)))
            tempTransitionName = doc.createElement("TransitionName")
            tempTransition.appendChild(tempTransitionName)
            tempTransitionName.appendChild(doc.createTextNode(tempPetri.transitionDict[transID].name))
            transitions.appendChild(tempTransition)
        #TODO all IDs seperate, edgeIDs are horrible, maybe two dicts (one to target with info, one for id)
        currid = 0
        edges = doc.createElement("edges")
        tempBac.appendChild(edges)
        for edgeID in tempPetri.edgeIDList:
            tempEdge = doc.createElement("ID" + str(currid))
            tempEdgeID = doc.createElement("EdgeID")
            tempEdge.appendChild(tempEdgeID)
            tempEdgeID.appendChild(doc.createTextNode(str(currid)))
            tempEdgeWeight = doc.createElement("EdgeWeight")
            tempEdge.appendChild(tempEdgeWeight)
            tempEdgeWeight.appendChild(doc.createTextNode(str(tempPetri.edgeDict[edgeID].weight)))
            tempEdgeSource = doc.createElement("EdgeSource")
            tempEdge.appendChild(tempEdgeSource)
            tempEdgeSource.appendChild(doc.createTextNode(str(tempPetri.edgeDict[edgeID].source)))
            tempEdgeSink = doc.createElement("EdgeSink")
            tempEdge.appendChild(tempEdgeSink)
            tempEdgeSink.appendChild(doc.createTextNode(str(tempPetri.edgeDict[edgeID].sink)))
            tempEdgeType = doc.createElement("EdgeType")
            tempEdge.appendChild(tempEdgeType)
            tempEdgeType.appendChild(doc.createTextNode(tempPetri.edgeDict[edgeID].edgeType))
            edges.appendChild(tempEdge)
            currid += 1
        bacteria.appendChild(tempBac)


    doc = doc.toprettyxml()
    file = open(filehandler, mode="w")
    file.write(doc)
    file.close()
    print("Saving")
